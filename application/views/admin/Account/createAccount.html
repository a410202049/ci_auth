<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=3ILYr69BvR9fs4FveYgPTLnzhH3CcsSy"></script>
    <style type="text/css">
        #allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
        .map-addr{
            height: 500px;
        }
        .store{
            margin-right: 15px;
        }
        .uploadFileBtn{
/*            width: 150px;
            height: 50px;
            background: #999;
            color: #fff;*/
        }
    </style>
<?php $this->load->view('admin/Common/nav.html');?>
    <div class="row">
        <div class="col-lg-12">

            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>添加用户组</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <?php
                        $leves = $this->config->item('leve');
                    ?>
                    <form method="post"  id="form-store-add">
                        <div class="form-group row">
                            <div class="col-sm-1">
                            <label>用户组设置：</label>
                                <select  class="form-control" id="group-setting">
                                    <?php foreach ($leves as $key => $value): ?>
                                        <option value="<?php echo $key;?>"><?php echo $value;?></option>
                                    <?php endforeach; ?> 
                                </select>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-inline" id="linkAge">

<!--                                 <div class="form-group padding-right lagre">
                                    <label>大区：</label>
                                        <select  class="form-control" id="area-large">
                                        </select>
                                </div>
                                <div class="form-group padding-right province" style="display: none;">
                                    <label>省：</label>
                                        <select  class="form-control" id="area-province">
                                        </select>
                                </div>
                                <div class="form-group padding-right city" style="display: none;">
                                    <label>市：</label>
                                        <select  class="form-control" id="area-city">
                                        </select>
                                </div>
                                <div class="form-group padding-right area-select area" style="display: none;">
                                    <label>管理区域：</label>
                                        <select class="form-control" id="custom-area" name="custom_area_id"></select>
                                </div>
                                <div class="form-group padding-right store" style="display: none;">
                                    <label>门店：</label>
                                        <select class="form-control" id="store" name="store_id"></select>
                                </div>
                                <div class="form-group padding-right storeManager" style="display: none;">
                                    <label>店经理：</label>
                                        <select class="form-control" id="storeManager" name="storeManager"></select>
                                </div> -->
                        </div>
                        <div class="form-horizontal">
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button type="submit" class="btn btn-primary">添加门店</button>
                                    <a class="btn btn-white" href="/admin/StoreManage/storeList">取消</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script src="<?php echo base_url('public/common/js/jsAddress.js')?>"></script>
    <script type="text/javascript">
        window.onload = function(){

            var arr = {}; 
            arr['groupid'] = 1;
            getLarge(arr);

            $('#group-setting').change(function(){
                v = $(this).val();
                if(v !='1' ){
                    arr['largeDefult'] = '6';
                    arr['provincesDefault'] = '530000';
                    arr['cityDefault'] = '530100';
                }
                arr['groupid'] = v;

                getLarge(arr);
            });

            function getLarge(arrs){

                $.ajax({
                     type: "POST",
                     url: "<?php echo site_url('admin/Account/getLinkAge') ?>",
                     data: arrs,
                     dataType: "json",
                     success: function(data){
                        if(data.status=='success'){
                            var selectStr = '<div class="form-group padding-right lagre"><label>大区：</label><select  class="form-control" id="area-large">';
                            for(var key in data.data['large']){
                                if(data.data['largeDefult'] == data.data['large'][key].id){
                                    selectStr+="<option value='"+data.data['large'][key].id+"' selected>"+data.data['large'][key].name+"</option>";
                                }else{
                                    selectStr+="<option value='"+data.data['large'][key].id+"'>"+data.data['large'][key].name+"</option>";
                                }
                            } 
                            selectStr+='</select></div>';
                            if(typeof(data.data['provinces']) !="undefined"){
                                selectStr+= '<div class="form-group padding-right province"><label>省：</label><select  class="form-control" id="area-province">';
                                for(var key in data.data['provinces']){
                                    if(data.data['provinceDefault'] == data.data['provinces'][key].provinceid){
                                        selectStr+="<option value='"+data.data['provinces'][key].provinceid+"' selected>"+data.data['provinces'][key].province+"</option>";
                                    }else{
                                        selectStr+="<option value='"+data.data['provinces'][key].provinceid+"'>"+data.data['provinces'][key].province+"</option>";
                                    }
                                } 
                                selectStr+='</select></div>';
                            }                          
                            
                            if(typeof(data.data['citys']) !="undefined"){
                                selectStr+= '<div class="form-group padding-right city"><label>市：</label><select  class="form-control" id="area-city">';
                                for(var key in data.data['citys']){
                                    if(data.data['cityDefault'] == data.data['citys'][key].cityid){
                                        selectStr+="<option value='"+data.data['citys'][key].cityid+"' selected>"+data.data['citys'][key].city+"</option>";
                                    }else{
                                        selectStr+="<option value='"+data.data['citys'][key].cityid+"'>"+data.data['citys'][key].city+"</option>";
                                    }
                                } 
                                selectStr+='</select></div>';
                            }

                            if(typeof(data.data['areas']) !="undefined" && data.data['areas']!="" ){
                                selectStr+= '<div class="form-group padding-right area-select area"><label>管理区域：</label><select  class="form-control" id="custom-area" name="custom_area_id">';
                                for(var key in data.data['areas']){
                                    if(data.data['areasDefault'] == data.data['areas'][key].id){
                                        selectStr+="<option value='"+data.data['areas'][key].id+"' selected>"+data.data['areas'][key].name+"</option>";
                                    }else{
                                        selectStr+="<option value='"+data.data['areas'][key].id+"'>"+data.data['areas'][key].name+"</option>";
                                    }
                                } 
                                selectStr+='</select></div>';
                            }

                            if(typeof(data.data['stores']) !="undefined" && data.data['stores']!=""){
                                selectStr+= '<div class="form-group padding-right store"><label>门店：</label><select  class="form-control" id="store" name="store_id">';
                                for(var key in data.data['stores']){
                                    if(data.data['storeDefult'] == data.data['stores'][key].id){
                                        selectStr+="<option value='"+data.data['stores'][key].id+"' selected>"+data.data['stores'][key].name+"</option>";
                                    }else{
                                        selectStr+="<option value='"+data.data['stores'][key].id+"'>"+data.data['stores'][key].name+"</option>";
                                    }
                                } 
                                selectStr+='</select></div>';
                            }
                            $('#linkAge').html(selectStr);
                        }
                 }})
            }

            //大区change
            $('body').on('change','#area-large',function(){
                groupid = parseInt($('#group-setting').val());
                var arr = {}; 
                arr['groupid'] = groupid;
                if(groupid != 1){
                    largeDefult = $('#area-large').val();
                    arr['largeDefult'] = largeDefult;
                    getLarge(arr);
                }

            });

            // //省份change
            // $('body').on('change','#area-province',function(){
            //     groupid = parseInt($('#group-setting').val());
            //     var arr = {}; 
            //     arr['groupid'] = groupid;
            //     switch(groupid){
            //         case '2':
            //             largeDefult = $('#area-large').val();
            //             arr['largeDefult'] = largeDefult;
            //             arr['provincesDefault'] = $('#area-province').val();
            //         break;
            //         default:

            //     }
            //     getLarge(arr);
            // });

            // area-province

            // $('#custom-area').change(function(){
            //     getStore($('#custom-area').val());
            // })

            // $('#area-large').change(function(){
            //     alert(1);
            //     // groupid = $('#group-setting').val();
            //     // switch(groupid)
            //     // {
            //     //     case 2:
            //     //         alert(2);
            //     //     case 3:
            //     //         alert(3);
            //     //     case 4:
            //     //         alert(4);
            //     //       break;
            //     //     default:
            //     // }
            //     // large = $(this).val();
            //     // arr['groupid'] = v;
            //     // getLarge(arr);
            //     // var groupid = groupid ? groupid : '';
            //     // var largeDefult = largeDefult ? largeDefult : '';
            //     // var cityDefault = cityDefault ? cityDefault : '';
            //     // var provinceDefault = provinceDefault? provinceDefault :'';
            //     // var areasDefault = areasDefault ? areasDefault : '';
            //     // var storeDefult = storeDefult ? storeDefult : '';

            // })
            
            // $('#area-province').change(function(){
            //     getCustomArea($(this).val(),'province');
            //     getStore($('#custom-area').val());
            // })

            // $('#area-city').change(function(){
            //     getCustomArea($(this).val(),'city');
            //     getStore($('#custom-area').val());
            //     // getStore($(this).val());
            // })

        }



        // function getCustomArea(id,type){
        //     $.ajax({
        //          type: "POST",
        //          url: "<?php echo site_url('admin/StoreManage/getCustomArea') ?>",
        //          data: {id:id,type:type},
        //          dataType: "json",
        //          success: function(data){
        //             if(data.status=='success'){
        //                 if(data.data.length== 0){
        //                     $('.area-select').css('display','none');
        //                 }else if($('#group-setting').val() == '3'){
        //                     $('.area-select').css('display','inline-block');
        //                 }
        //                 area = $('#custom-area');
        //                 str = "";
        //                 for(var i=0; i<data.data.length; i++){
        //                     str+= '<option value="'+data.data[i]['id']+'">'+data.data[i]['name']+'</option>';
        //                 }
        //                 area.html(str);
        //             }
        //      }})
        // }

        // function getStore(id){
        //     $.ajax({
        //          type: "POST",
        //          url: "<?php echo site_url('admin/Account/getStore') ?>",
        //          data: {id:id},
        //          dataType: "json",
        //          success: function(data){
        //             if(data.status=='success'){
        //                 if(data.data.length== 0){
        //                     $('.store').css('display','none');
        //                 }else if($('#group-setting').val() == '4' || $('#group-setting').val() == '5'){
        //                     store = $('#store');
        //                     str = "";
        //                     for(var i=0; i<data.data.length; i++){
        //                         str+= '<option value="'+data.data[i]['id']+'">'+data.data[i]['name']+'</option>';
        //                     }
        //                     store.html(str);
        //                     $('.store').css('display','inline-block');
        //                 }

        //             }
        //      }})
        // }

    </script>
<?php $this->load->view('admin/Common/footer.html');?>          



