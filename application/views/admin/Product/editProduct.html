<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=3ILYr69BvR9fs4FveYgPTLnzhH3CcsSy"></script>
    <style type="text/css">
        #allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
        .map-addr{
            height: 500px;
        }
        .store{
            margin-right: 15px;
        }
        .uploadFileBtn{
/*            width: 150px;
            height: 50px;
            background: #999;
            color: #fff;*/
        }
    </style>
<?php $this->load->view('admin/Common/nav.html');?>
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>添加文章</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <form method="post" id="add-article">
                        <div class="form-horizontal">
                        <div class="form-group">
                            <label class="col-lg-2 control-label">选择分类：</label>
                            <div class="col-sm-2">
                                <select id="cat_id" name="cat_id" class="form-control m-b valid">
                                    <?php echo $categorys;?> 
                                </select>                            
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章标题：</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" name="title" value="<?php echo $result['title'];?>">
                                <input type="hidden" name="id" value="<?php echo $result['id'];?>">
                            </div>
                            <label class="col-sm-2 control-label">文章英文标题：</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" name="title_en" value="<?php echo $result['title_en'];?>">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章关键词：</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" name="keywords" value="<?php echo $result['keywords'];?>">
                            </div>

                            <label class="col-sm-2 control-label">文章英文关键词：</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" name="keywords_en" value="<?php echo $result['keywords_en'];?>">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章描述：</label>
                            <div class="col-sm-3">
                                <textarea class="form-control" name="description"><?php echo $result['description'];?></textarea>
                            </div>
                            <label class="col-sm-2 control-label">文章英文描述：</label>
                            <div class="col-sm-3">
                                <textarea class="form-control" name="description_en"><?php echo $result['description_en'];?></textarea>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章封面：</label>
                            <div class="col-sm-8">
                            <?php if($result['image']){?>
                            <ul class="imgListUp">
                                <li>
                                    <div class="file_bar"><p class="file_name">article/1468835853.jpg</p><span class="file_del" data-index="0" title="删除"></span>
                                    </div>
                                    <img src="/public/uploads/<?php echo $result['image'];?>"><input type="hidden" value="<?php echo $result['image'];?>" name="imagesList">
                                </li>
                            </ul>
                            <?php }?>
                                <div id="selector" class="btn btn-primary uploadFileBtn"><i class="fa fa-plus"></i>&nbsp;&nbsp;添加封面</div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章正文：</label>
                            <div class="col-sm-10">
                                <script id="content" name="content" type="text/plain" style="height:300px;"><?php echo htmlspecialchars_decode($result['content']);?></script>
                            </div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文章英文正文：</label>
                            <div class="col-sm-10">
                                <script id="content_en" name="content_en" type="text/plain" style="height:300px;"><?php echo htmlspecialchars_decode($result['content']);?></script>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <button type="submit" class="btn btn-primary" >编辑文章</button>
                                <a class="btn btn-white" href="<?php echo base_url('admin/Article/articleList')?>">返回</a>
                            </div>
                        </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="<?php echo base_url('public/admin/js/plugins/ueditor/ueditor.config.js')?>"></script>
    <script type="text/javascript" src="<?php echo base_url('public/admin/js/plugins/ueditor/ueditor.all.js')?>"></script>
    <script type="text/javascript">
        window.onload = function(){
            var ue = UE.getEditor('content');
            var ue_en = UE.getEditor('content_en');



            var up = new Upload("<?php echo site_url('admin/Index/do_upload/?filepath=article') ?>",'selector','1');

            $("#add-article").validate({
                rules: {
                  title:"required",
                  title_en:"required",
                  keyword:"required",
                  keyword_en:"required",
                  description:"required",
                  description_en:"required"
                },
                messages: {
                  title: "站点名称不能为空",
                  title_en: "站点英文名称不能为空",
                  keywords: "关键词不能为空",
                  keywords_en: "英文关键词不能为空",
                  description: "描述不能为空",
                  description_en: "英文描述不能为空"
                },
                submitHandler:function(form){
                    if(ue.getContent() == '' || ue_en.getContent() == ''){
                        layer.msg('文章正文或文章英文正文不能为空',{icon: 2});
                    }else{
                        $.ajax({
                         type: "POST",
                         url: "<?php echo base_url('admin/Article/editArticle');?>",
                         data: $(form).serialize(),
                         dataType: "json",
                         success: function(data){
                            if(data.status=='success'){
                                layer.msg(data.message,{icon: 1});
                                window.location.href = "<?php echo base_url('admin/Article/articleList');?>";
                            }else{
                                layer.msg(data.message,{icon: 2});
                            }
                         }})
                    }

                }
            })

            $('#cat_id [value="<?php echo $result["cat_id"];?>"]').attr("selected",true);
        }
    </script>
<?php $this->load->view('admin/Common/footer.html');?>          



